name: Sync Multiple Azure DevOps Repos to GitHub

on:
  schedule:
    - cron: "0 0 * * *"  # Ch·∫°y m·ªói ng√†y l√∫c 00:00 UTC
  workflow_dispatch:  # Cho ph√©p ch·∫°y th·ªß c√¥ng

jobs:
  sync-multiple-repos:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout GitHub repo
        uses: actions/checkout@v4

      - name: Clone and Sync Multiple Repositories
        env:
          AZURE_ORG: "thienthutula1109"
          AZURE_PROJECT: "phongmx"
          GITHUB_USERNAME: "xuanphongit"
          AZURE_DEVOPS_PAT: ${{ secrets.AZURE_DEVOPS_PAT }}
          GITHUB_PAT: ${{ secrets.GITHUB_PAT }}
          AZURE_REPO_LIST: "First%20Repo Second%20Repo"  # Danh s√°ch repo tr√™n Azure
          GITHUB_REPO_LIST: "first-repo second-repo"  # Danh s√°ch repo tr√™n GitHub (t∆∞∆°ng ·ª©ng)
        run: |
          AZURE_REPOS=($AZURE_REPO_LIST)
          GITHUB_REPOS=($GITHUB_REPO_LIST)

          if [ ${#AZURE_REPOS[@]} -ne ${#GITHUB_REPOS[@]} ]; then
            echo "‚ö†Ô∏è L·ªói: S·ªë l∆∞·ª£ng repo kh√¥ng kh·ªõp gi·ªØa Azure v√† GitHub!"
            exit 1
          fi

          for i in "${!AZURE_REPOS[@]}"; do
            AZURE_REPO="${AZURE_REPOS[$i]}"
            GITHUB_REPO="${GITHUB_REPOS[$i]}"

            echo "üîÑ ƒêang ƒë·ªìng b·ªô: $AZURE_REPO ‚Üí $GITHUB_REPO"

            # Clone Azure DevOps repo
            git clone --mirror https://$AZURE_DEVOPS_PAT@dev.azure.com/$AZURE_ORG/$AZURE_PROJECT/_git/$AZURE_REPO $AZURE_REPO

            cd $AZURE_REPO

            # Add GitHub as a remote
            git remote add github https://$GITHUB_PAT@github.com/$GITHUB_USERNAME/$GITHUB_REPO.git
            
            # Push to GitHub
            git push --mirror github

            cd ..
            rm -rf $AZURE_REPO  # Cleanup
          done
